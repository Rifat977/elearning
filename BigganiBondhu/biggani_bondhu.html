<!-- static/index.html -->
<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®‡ßÄ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ Chat & Myth Busting</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="max-w-4xl mx-auto p-4 space-y-8">

    <!-- Gallery + Single Chat -->
    <div id="scientist-chat-module">
      <h2 class="text-2xl font-semibold mb-4">Roleplay as Scientist</h2>
      <div id="scientist-gallery" class="grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>
    </div>

    <!-- Myth Evaluation -->
    <div id="myth-eval" class="space-y-4">
      <h2 class="text-2xl font-semibold">Evaluate Myth</h2>
      <textarea id="myth-input" rows="3" class="w-full border rounded p-2" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Æ‡¶ø‡¶• ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
      <button id="eval-btn" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">Evaluate Myth</button>
      <pre id="eval-output" class="whitespace-pre-wrap bg-gray-50 p-4 rounded border text-gray-800"></pre>
    </div>

    <!-- Myth Busting Roundtable -->
    <div id="myth-bust" class="space-y-4">
      <h2 class="text-2xl font-semibold">Myth Busting Roundtable</h2>
      <textarea id="bust-input" rows="3" class="w-full border rounded p-2" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Æ‡¶ø‡¶• ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
      <button id="bust-btn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Start Roundtable</button>
      <pre id="bust-output" class="whitespace-pre-wrap bg-gray-50 p-4 rounded border text-gray-800"></pre>
    </div>

  </div>

  <!-- Single Chat Modal -->
  <div id="chat-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white w-full max-w-md md:max-w-lg h-full md:h-3/4 rounded-lg shadow-lg flex flex-col overflow-hidden">
      <div class="flex items-center p-4 bg-blue-50 border-b">
        <img id="modal-avatar" class="w-12 h-12 rounded-full mr-3" />
        <h2 id="modal-name" class="text-xl font-semibold flex items-center"></h2>
        <button id="close-modal" class="ml-auto text-gray-500 hover:text-gray-800 text-2xl">√ó</button>
      </div>
      <div id="message-container" class="flex-1 p-4 overflow-y-auto space-y-3 bg-gray-50">
        <div id="empty-placeholder" class="text-center text-gray-400">‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶è‡¶ñ‡¶®‡¶ì ‡¶®‡ßá‡¶á‡•§</div>
      </div>
      <div class="p-4 border-t flex">
        <input id="user-input" type="text" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." class="flex-1 border rounded-l px-3 py-2 focus:outline-none" />
        <button id="send-btn" disabled class="bg-blue-400 text-white px-4 rounded-r hover:bg-blue-500 disabled:opacity-50">‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
    </div>
  </div>

  <script>
    // Scientist data
    const scientists = [
      { id: 'einstein', name: '‡¶Ü‡¶≤‡¶¨‡¶æ‡¶∞‡ßç‡¶ü ‡¶Ü‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶®', quote: '‡¶ï‡¶≤‡ßç‡¶™‡¶®‡¶æ‡¶∂‡¶ï‡ßç‡¶§‡¶ø ‡¶ú‡ßç‡¶û‡¶æ‡¶®‡ßá‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡•§', avatar: 'https://www.sciencekids.co.nz/images/pictures/scientists/alberteinstein.jpg', emoji: 'üî¨' },
                { id: 'curie', name: '‡¶Æ‡ßá‡¶∞‡¶ø ‡¶ï‡¶ø‡¶â‡¶∞‡¶ø', quote: '‡¶ï‡¶æ‡¶ú‡¶á ‡¶ï‡ßÅ‡¶ñ‡ßç‡¶Ø‡¶æ‡¶§‡¶ø ‡¶®‡¶Ø‡¶º‡•§', avatar: 'https://www.sciencekids.co.nz/images/pictures/scientists/mariecurie.jpg', emoji: '‚öõÔ∏è' },
                { id: 'bose', name: '‡¶∏‡¶§‡ßç‡¶Ø‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶®‡¶æ‡¶• ‡¶¨‡ßã‡¶∏', quote: '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®‡¶á ‡¶ß‡¶∞‡ßç‡¶Æ‡•§', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/fe/SatyenBose1925.jpg', emoji: 'üî≠' },
                { id: 'hawking', name: '‡¶∏‡ßç‡¶ü‡¶ø‡¶´‡ßá‡¶® ‡¶π‡¶ï‡¶ø‡¶Ç', quote: '‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶Æ‡¶® ‡¶∏‡ßç‡¶•‡¶ø‡¶∞ ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®‡•§', avatar: 'https://www.sciencekids.co.nz/images/pictures/scientists/stephenhawking.jpg', emoji: 'üåå' },
                { id: 'newton', name: '‡¶Ü‡¶á‡¶ú‡ßç‡¶Ø‡¶æ‡¶ï ‡¶®‡¶ø‡¶â‡¶ü‡¶®', quote: '‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡ßá‡¶ï‡¶ü‡¶ø ‡¶ï‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶® ‡¶ì ‡¶¨‡¶ø‡¶™‡¶∞‡ßÄ‡¶§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶∞‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', avatar: 'https://www.sciencekids.co.nz/images/pictures/scientists/isaacnewton.jpg', emoji: 'üçé' },
                { id: 'tesla', name: '‡¶®‡¶ø‡¶ï‡ßã‡¶≤‡¶æ ‡¶ü‡ßá‡¶∏‡¶≤‡¶æ', quote: '‡¶≠‡¶¨‡¶ø‡¶∑‡ßç‡¶Ø‡¶§‡ßá ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑ ‡¶ö‡ßã‡¶ñ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶¶‡ßá‡¶ñ‡¶¨‡ßá ‡¶®‡¶æ, ‡¶§‡¶æ‡¶∞‡¶æ ‡¶Æ‡¶® ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ö‡¶®‡ßÅ‡¶≠‡¶¨ ‡¶ï‡¶∞‡¶¨‡ßá‡•§', avatar: 'https://www.sciencekids.co.nz/images/pictures/scientists/nikolatesla.jpg', emoji: '‚ö°' },
                { id: 'darwin', name: '‡¶ö‡¶æ‡¶∞‡ßç‡¶≤‡¶∏ ‡¶°‡¶æ‡¶∞‡¶â‡¶á‡¶®', quote: '‡¶á‡¶∏‡ßç‡¶§‡ßç‡¶∞‡ßÄ‡¶∞ ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá ‡¶¨‡ßá‡¶Å‡¶ö‡ßá ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶æ ‡¶®‡¶Ø‡¶º, ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ú‡¶®‡ßá ‡¶∏‡¶ï‡ßç‡¶∑‡¶Æ‡¶∞‡¶æ ‡¶¨‡ßá‡¶Å‡¶ö‡ßá ‡¶•‡¶æ‡¶ï‡ßá‡•§', avatar: 'https://www.sciencekids.co.nz/images/pictures/scientists/charlesdarwin.jpg', emoji: 'üß¨' },
                { id: 'galileo', name: '‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶≤‡¶ø‡¶ì ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶≤‡¶ø', quote: '‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶§‡¶æ‡¶π‡¶æ ‡¶®‡¶æ ‡¶ï‡¶∞‡¶ø‡¶≤‡ßá, ‡¶∏‡ßÅ‡¶§‡¶∞‡¶æ‡¶Ç ‡¶§‡¶æ‡¶π‡¶æ ‡¶π‡¶Ø‡¶º ‡¶®‡¶æ‡•§', avatar: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Justus_Sustermans_-_Portrait_of_Galileo_Galilei%2C_1636.jpg/500px-Justus_Sustermans_-_Portrait_of_Galileo_Galilei%2C_1636.jpg', emoji: 'üî≠' },
                { id: 'maxwell', name: '‡¶ú‡ßá‡¶Æ‡¶∏ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡¶ì‡¶Ø‡¶º‡ßá‡¶≤', quote: '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶¨‡¶ø‡¶∂‡¶¶ ‡¶™‡¶∞‡ßç‡¶Ø‡¶¨‡ßá‡¶ï‡ßç‡¶∑‡¶£, ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶™, ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡•§', avatar: 'https://upload.wikimedia.org/wikipedia/commons/5/57/James_Clerk_Maxwell.png', emoji: 'üìä' },
                { id: 'faraday', name: '‡¶Æ‡¶æ‡¶á‡¶ï‡ßá‡¶≤ ‡¶´‡¶æ‡¶∞‡¶æ‡¶°‡ßá', quote: '‡¶®‡¶æ ‡¶ú‡¶æ‡¶®‡¶æ ‡¶Ö‡¶®‡ßá‡¶ï ‡¶¨‡¶°‡¶º ‡¶Ö‡¶™‡¶∞‡¶æ‡¶ß‡•§', avatar: 'https://encrypted-tbn2.gstatic.com/images?q=tbn:ANd9GcQ5WLF66zt86imkCC4U46lqjXEptVLwaA625O_VfZvAfZtXysHr-6n3oqY8qemQALuyS26OZtmIxu3Y8GrfdTzbVpXUE952AyYNbR0XRlQ', emoji: 'üîã' },
                { id: 'feynman', name: '‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶° ‡¶´‡ßá‡¶á‡¶®‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®', quote: '‡¶Ø‡¶¶‡¶ø ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶¨‡ßÅ‡¶ù‡¶§‡ßá ‡¶®‡¶æ ‡¶™‡¶æ‡¶∞‡ßã, ‡¶Ø‡¶•‡ßá‡¶∑‡ßç‡¶ü‡¶≠‡¶æ‡¶¨‡ßá ‡¶ó‡¶≠‡ßÄ‡¶∞‡ßá ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶® ‡¶ï‡¶∞‡ßã‡•§', avatar: 'https://upload.wikimedia.org/wikipedia/commons/1/1a/RichardFeynman-PaineMansionWoods1984_copyrightTamikoThiel_bw.jpg', emoji: 'üß†' },
                { id: 'bohr', name: '‡¶®‡¶ø‡¶≤‡¶∏ ‡¶¨‡ßã‡¶∞', quote: '‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ï‡¶∞‡¶æ‡¶ü‡¶æ ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ö‡¶®‡ßá‡¶ï ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ú‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶ô‡ßç‡¶ó‡ßÄ‡¶ï‡¶æ‡¶∞‡•§', avatar: 'https://upload.wikimedia.org/wikipedia/commons/6/6d/Niels_Bohr.jpg', emoji: '‚ò¢Ô∏è' },
                { id: 'curie_s', name: '‡¶™‡¶ø‡¶Ø‡¶º‡ßá‡¶∞‡ßá ‡¶ï‡¶ø‡¶â‡¶∞‡¶ø', quote: '‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ ‡¶Ö‡¶∏‡ßç‡¶§‡ßç‡¶∞‡•§', avatar: 'https://via.placeholder.com/150', emoji: 'üìö' },
                { id: 'lovelace', name: '‡¶Ü‡¶¶‡¶æ ‡¶≤‡¶æ‡¶≠‡ßá‡¶≤‡ßá‡¶∏', quote: '‡¶Ø‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶ö‡¶æ‡¶≤‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑‡ßá‡¶∞ ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶™‡ßá‡¶ï‡ßç‡¶∑‡ßá‡•§', avatar: 'https://via.placeholder.com/150', emoji: 'üíª' },
                { id: 'turing', name: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶® ‡¶ü‡ßÅ‡¶∞‡¶ø‡¶Ç', quote: '‡¶Ø‡¶®‡ßç‡¶§‡ßç‡¶∞ ‡¶ï‡¶ø ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá? ‡¶è‡¶ü‡¶æ‡¶á ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡•§', avatar: 'https://via.placeholder.com/150', emoji: 'üßÆ' },
                { id: 'edison', name: '‡¶•‡¶Æ‡¶æ‡¶∏ ‡¶è‡¶°‡¶ø‡¶∏‡¶®', quote: '‡¶Ü‡¶Æ‡¶ø ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶á‡¶®‡¶ø, ‡¶Ü‡¶Æ‡¶ø ‡ßß‡ß¶‡ß¶‡ß¶‡¶ü‡¶ø ‡¶â‡¶™‡¶æ‡¶Ø‡¶º ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡¶ø ‡¶Ø‡¶æ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡•§', avatar: 'https://via.placeholder.com/150', emoji: 'üí°' }
    ];

    // DOM refs
    const G = id => document.getElementById(id),
          gallery = G('scientist-gallery'),
          modal   = G('chat-modal'),
          msgC    = G('message-container'),
          empty   = G('empty-placeholder'),
          avatar  = G('modal-avatar'),
          nameEl  = G('modal-name'),
          userIn  = G('user-input'),
          sendBtn = G('send-btn'),
          mythIn  = G('myth-input'),
          evalBtn = G('eval-btn'),
          evalOut = G('eval-output'),
          bustIn  = G('bust-input'),
          bustBtn = G('bust-btn'),
          bustOut = G('bust-output');
    let current = null;

    // Render gallery & modal logic
    function renderGallery() {
      scientists.forEach(sci => {
        let card = document.createElement('div');
        card.className = 'bg-white rounded-lg shadow p-4 text-center flex flex-col items-center';
        card.innerHTML = `
          <img src="${sci.avatar}" class="w-24 h-24 rounded-full mb-2"/>
          <h3 class="font-semibold mb-1">${sci.name}</h3>
          <p class="text-sm text-gray-600 mb-3">${sci.quote}</p>
          <button class="chat-btn bg-green-500 text-white px-3 py-1 rounded">‡¶Ü‡¶≤‡ßã‡¶ö‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>`;
        card.querySelector('.chat-btn').onclick = () => openModal(sci);
        gallery.appendChild(card);
      });
    }

    function openModal(sci) {
      current = sci;
      avatar.src = sci.avatar;
      nameEl.textContent = `${sci.emoji} ${sci.name}`;
      msgC.innerHTML = '';
      empty.classList.remove('hidden');
      modal.classList.remove('hidden');
      sendBtn.disabled = true;
    }

    G('close-modal').onclick = () => modal.classList.add('hidden');

    function appendMsg(sender, text) {
      empty.classList.add('hidden');
      let d = document.createElement('div');
      d.className = sender==='user'?'text-right':'text-left';
      d.innerHTML = `<span class="inline-block bg-gray-200 rounded px-3 py-1">${text}</span>`;
      msgC.appendChild(d);
      msgC.scrollTop = msgC.scrollHeight;
    }

    async function sendMsg() {
      let t = userIn.value.trim(); if(!t||!current) return;
      appendMsg('user', t);
      userIn.value=''; sendBtn.disabled=true;
      appendMsg('bot','‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡¶õ‡ßá‡¶®...');
      let res = await fetch('/role_play_api/', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({query:t,character_id:current.id})
      });
      msgC.lastChild.remove();
      let j = await res.json();
      appendMsg('bot', j.text||j.error);
    }

    userIn.oninput = () => sendBtn.disabled = !userIn.value.trim();
    sendBtn.onclick = sendMsg;
    userIn.onkeyup = e => e.key==='Enter' && sendMsg();

    // Evaluate Myth
    evalBtn.onclick = async () => {
      let myth = mythIn.value.trim();
      if(!myth) return;
      evalOut.textContent = 'Evaluating...';
      let res = await fetch('/evaluate_api/', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({myth})
      });
      let j = await res.json();
      evalOut.textContent = j.text || j.error;
    };

    // Myth Busting Roundtable
    bustBtn.onclick = async () => {
      let myth = bustIn.value.trim();
      if(!myth) return;
      bustOut.textContent = 'Starting roundtable...';
      let res = await fetch('/myth_bust_api/', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({myth})
      });
      let j = await res.json();
      bustOut.textContent = j.text || j.error;
    };

    // init
    renderGallery();
  </script>
</body>
</html>
